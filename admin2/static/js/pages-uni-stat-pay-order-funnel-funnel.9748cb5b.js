(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-uni-stat-pay-order-funnel-funnel"],{"08a1":function(t,e,a){"use strict";a.r(e);var n=a("6fc9"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},"08f4":function(t,e,a){"use strict";a("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.fieldsMap=void 0;e.fieldsMap=[{title:"活跃设备数",field:"activity_device_count",tooltip:"统计时间内，访问设备数，一台设备多次访问被计为一台（包含未登录的用户）。",formatter:",",value:0,contrast:0,stat:"sum"},{title:"活跃用户数",field:"activity_user_count",tooltip:"活跃用户数：统计时间内，访问人数，一人多次访问被计为一人（只统计已登录的用户）。",formatter:",",value:0,contrast:0,stat:"sum"},{title:"支付用户数",field:"pay_user_count",tooltip:"统计时间内，成功支付的人数（不剔除退款订单）（只统计已登录的用户）。",formatter:",",value:0,contrast:0,stat:"sum"}]},2804:function(t,e,a){"use strict";a.r(e);var n=a("673d"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},"47d73":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniStatTabs:a("ec04").default,uniDatetimePicker:a("f096").default,qiunDataCharts:a("47d7").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"uni-stat--x p-m"},[a("v-uni-view",{staticClass:"uni-stat-card-header"},[t._v("漏斗分析")]),a("v-uni-view",{staticClass:"flex"},[a("uni-stat-tabs",{attrs:{type:"box",current:t.dateTabs.index,tabs:t.dateTabs.list},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.dateTabsChange.apply(void 0,arguments)}}}),a("uni-datetime-picker",{staticClass:"uni-stat-datetime-picker",attrs:{type:"date",end:Date.now(),"return-type":"timestamp","clear-icon":!1},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.datePickerChange.apply(void 0,arguments)}},model:{value:t.dateTabs.time,callback:function(e){t.$set(t.dateTabs,"time",e)},expression:"dateTabs.time"}}),t.dateTabs.timeStr?a("v-uni-view",{staticClass:"uni-stat--tips"},[t._v("当前时间范围："+t._s(t.dateTabs.timeStr))]):t._e()],1),t.notData?a("v-uni-view",{staticClass:"uni-charts-box flex center"},[a("v-uni-view",[t._v("暂无数据")])],1):a("v-uni-view",{staticClass:"uni-charts-box"},[a("qiun-data-charts",{attrs:{type:"funnel",chartData:t.chartData,opts:t.opts,errorMessage:t.errorMessage}})],1)],1)},r=[]},"5be1":function(t,e,a){"use strict";var n=a("ef49"),i=a.n(n);i.a},"673d":function(t,e,a){"use strict";(function(t){a("7a82");var n=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("d3b7"),a("d81d"),a("a9e3"),a("14d9"),a("99af");var i=n(a("b85c")),r=n(a("5530")),s=a("b0a6"),u=n(a("96ae")),d=a("08f4"),o={props:{query:{type:[Object],default:function(){return{}}}},data:function(){return{tableName:"uni-stat-pay-result",chartData:{},errorMessage:"",opts:{color:["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],padding:[15,15,0,15],legend:{},enableScroll:!0,xAxis:{disableGrid:!0,itemCount:24,fontSize:12},yAxis:{gridType:"dash",dashLength:2,data:[{tofix:2,unit:"%"}]},extra:{area:{type:"straight",opacity:.2,addLine:!0,width:2,gradient:!1}}},dateTabs:{time:[],timeStr:"",index:0,list:[{_id:7,name:"最近七天",dimension:"day"},{_id:30,name:"最近30天",dimension:"day"},{_id:90,name:"最近90天",dimension:"day"},{_id:372,name:"月维度",dimension:"month"},{_id:1116,name:"季维度",dimension:"quarter"},{_id:4392,name:"年维度",dimension:"year"}]},statTabs:{index:0,list:[{_id:1,name:"支付转化率"}]},queryMode:0}},created:function(){var t=this;this.getCloudDataDebounce=(0,s.debounce)((function(){t.getCloudData()}),300),this.getCloudDataDebounce()},methods:{getCloudData:function(){var e=this,a=this.query;if(a.appid){this.errorMessage="";var n=this.getWhere(),i=(0,r.default)((0,r.default)({},a),n);i=(0,s.stringifyQuery)(i,!0,["uni_platform"]);var u=t.database();u.collection(this.tableName).where(i).field("".concat((0,s.stringifyField)(d.fieldsMap),", start_time")).groupBy("start_time, dimension").groupField((0,s.stringifyGroupField)(d.fieldsMap)).orderBy("start_time","asc").limit(100).get({getCount:!0}).then((function(t){var a=t.result,i=(a.count,a.data);i=(0,s.fillTrendChartData)(i,n,d.fieldsMap),i.map((function(t,e){t.value=Number((t.pay_user_count/t.activity_user_count*100).toFixed(2)),isNaN(t.value)&&(t.value=0)})),e.setChartData(i,n.dimension)})).catch((function(t){})).finally((function(){}))}else this.errorMessage="请先选择应用"},setChartData:function(t,e){var a,n={categories:[],series:[{name:"支付转化率",data:[]}]},r=(0,i.default)(t);try{for(r.s();!(a=r.n()).done;){var s=a.value,u=this.formatDate(s.start_time,e);n.categories.push(u);var d=Number(s.value);n.series[0].data.push(d)}}catch(o){r.e(o)}finally{r.f()}this.chartData=n},formatDate:function(t,e){var a=new Date(t),n=a.getFullYear(),i=a.getMonth()+1,r=a.getDate(),u=a.getHours(),d=Math.floor((a.getMonth()+3)/3);return i<10&&(i="0"+i),r<10&&(r="0"+r),"hour"===e?"".concat(u,"时"):"month"===e?"".concat(n,"-").concat(i):"quarter"===e?"".concat(n,"/Q").concat(d):"year"===e?"".concat(n):(0,s.parseDateTime)(a)},datePickerChange:function(t){this.dateTabs.time=t,this.queryMode=1,this.getCloudData()},dateTabsChange:function(t,e){this.dateTabs.index=e,this.queryMode=0,this.getCloudData()},statTabsChange:function(t,e,a){this.statTabs.index=e,this.getCloudData({field:t,name:a})},getWhere:function(){var t=[],e=this.dateTabs.list[this.dateTabs.index]||{};if("number"===typeof e._id&&0===this.queryMode){var a=(0,s.getTimeOfSomeDayAgo)(e._id),n=u.default.getOffsetStartAndEnd("day",0).endTime;1==e._id&&(n=u.default.getOffsetStartAndEnd("day",0,a).endTime),t=[a,n]}else this.dateTabs.time&&(t=this.dateTabs.time);var i=e.dimension||"day";return this.dateTabs.timeStr="".concat(u.default.timeFormat(t[0])," ~ ").concat(u.default.timeFormat(t[1])),this.dateTabs.time=t,{dimension:i,start_time:t}}},watch:{query:{deep:!0,handler:function(t){this.getCloudDataDebounce()}}},computed:{}};e.default=o}).call(this,a("a9ff")["default"])},"6bbf":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniStatBreadcrumb:a("7593").default,uniDataSelect:a("8301").default,uniStatTabs:a("ec04").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"fix-top-window"},[a("v-uni-view",{staticClass:"uni-header"},[a("uni-stat-breadcrumb",{staticClass:"uni-stat-breadcrumb-on-phone"})],1),a("v-uni-view",{staticClass:"uni-container"},[a("v-uni-view",{staticClass:"uni-stat--x flex p-1015"},[a("uni-data-select",{attrs:{collection:"opendb-app-list",field:"appid as value, name as text",orderby:"text asc","def-item":1,label:"应用选择",clear:!1},model:{value:t.query.appid,callback:function(e){t.$set(t.query,"appid",e)},expression:"query.appid"}}),a("uni-data-select",{staticClass:"ml-m",attrs:{collection:"opendb-app-versions",where:t.versionQuery,field:"_id as value, version as text, uni_platform as label, create_date as date",format:"{label} - {text}",orderby:"date desc",label:"版本选择"},model:{value:t.query.version_id,callback:function(e){t.$set(t.query,"version_id",e)},expression:"query.version_id"}})],1),a("v-uni-view",{staticClass:"uni-stat--x"},[a("uni-stat-tabs",{attrs:{label:"平台选择",type:"boldLine",mode:"platform"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.platformChange.apply(void 0,arguments)}},model:{value:t.query.platform_id,callback:function(e){t.$set(t.query,"platform_id",e)},expression:"query.platform_id"}}),t.query.platform_id&&-1===t.query.platform_id.indexOf("==")?a("uni-data-select",{ref:"version-select",staticClass:"p-channel",attrs:{collection:"uni-stat-app-channels",where:t.channelQuery,field:"_id as value, channel_name as text",orderby:"text asc",label:"渠道/场景值选择"},model:{value:t.query.channel_id,callback:function(e){t.$set(t.query,"channel_id",e)},expression:"query.channel_id"}}):t._e()],1),a("funnelChart",{attrs:{query:t.query}}),a("trendChart",{attrs:{query:t.query}})],1)],1)},r=[]},"6fc9":function(t,e,a){"use strict";a("7a82");var n=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("b0a6"),r=(n(a("96ae")),n(a("f999"))),s=n(a("b6ce")),u={components:{funnelChart:r.default,trendChart:s.default},data:function(){return{tableName:"uni-stat-pay-result",query:{dimension:"hour",appid:"",platform_id:"",uni_platform:"",version_id:"",start_time:[]},loading:!1}},onLoad:function(t){var e=t.appid;e&&(this.query.appid=e)},created:function(){},methods:{platformChange:function(t,e,a,n){this.query.version_id=0,this.query.uni_platform=n.code}},watch:{},computed:{versionQuery:function(){var t=this.query,e=t.appid,a=t.uni_platform,n=(0,i.stringifyQuery)({appid:e,uni_platform:a});return n},channelQuery:function(){var t=this.query,e=t.appid,a=t.platform_id,n=(0,i.stringifyQuery)({appid:e,platform_id:a});return n}}};e.default=u},"74b1":function(t,e,a){"use strict";(function(t){a("7a82");var n=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("5530"));a("acd8"),a("d81d"),a("c975"),a("a9e3"),a("99af");var r=a("b0a6"),s=n(a("96ae")),u=a("08f4"),d={props:{query:{type:[Object],default:function(){return{}}}},data:function(){return{tableName:"uni-stat-pay-result",fieldsMap:u.fieldsMap,chartData:{},errorMessage:"",notData:!1,opts:{color:["#1890FF","#91CB74","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],padding:[15,15,0,15],extra:{funnel:{activeOpacity:.3,activeWidth:10,border:!0,borderWidth:2,borderColor:"#FFFFFF",fillOpacity:1,labelAlign:"right",linearType:"custom",minSize:20}}},dateTabs:{time:Date.now(),timeStr:"",index:0,list:[{_id:"day",name:"日维度"},{_id:"week",name:"周维度"},{_id:"month",name:"月维度"}]}}},created:function(){var t=this;this.getCloudDataDebounce=(0,r.debounce)((function(){t.getCloudData()}),400),this.getCloudDataDebounce()},methods:{calcPercentage:function(t,e){return e>0?parseFloat((t/e*100).toFixed(2)):0},getCloudData:function(){var e=this,a=this.query;if(a.appid){var n=this.getWhere(),s=(0,i.default)((0,i.default)({},a),n);s=(0,r.stringifyQuery)(s,!1,["uni_platform"]);var d=t.database();d.collection(this.tableName).where(s).field("".concat((0,r.stringifyField)(u.fieldsMap),", dimension, stat_date.date_str as stat_time, start_time")).groupBy("null").groupField((0,r.stringifyGroupField)(u.fieldsMap)).get().then((function(t){var a=t.result.data;if(a.length){e.errorMessage="",a.map((function(t){for(var e in t)e.indexOf("_amount")>1&&(t[e]=Number((t[e]/100).toFixed(2)))}));var n=a[0]||{},i=n.activity_device_count,r=void 0===i?0:i,s=n.activity_user_count,u=void 0===s?0:s,d=n.pay_user_count,o=void 0===d?0:d;e.notData=!(r||u||o);var c={series:[{data:[{name:"活跃设备数量",value:r,centerText:"".concat(r),labelText:"活跃设备数"},{name:"活跃用户数量",value:u,centerText:"".concat(u),labelText:"活跃用户数（用户转化率：".concat(e.calcPercentage(u,r),"%）")},{name:"支付用户数量",value:o,centerText:"".concat(o),labelText:"支付用户数（支付转化率：".concat(e.calcPercentage(o,u),"%）")}]}]};e.chartData=c}else e.errorMessage="暂无数据"}))}else this.errorMessage="请先选择应用"},dateTabsChange:function(t,e){this.dateTabs.index=e,this.getCloudData()},datePickerChange:function(t){this.dateTabs.time=t,this.getCloudData()},getWhere:function(){var t=this.dateTabs.time,e=this.dateTabs.list[this.dateTabs.index]._id||"day",a=[];if("day"===e){var n=s.default.getOffsetStartAndEnd("day",0,t),i=n.startTime,r=n.endTime;a=[i,r]}else if("week"===e){var u=s.default.getOffsetStartAndEnd("week",0,t),d=u.startTime,o=u.endTime;a=[d,o]}else if("month"===e){var c=s.default.getOffsetStartAndEnd("month",0,t),l=c.startTime,f=c.endTime;a=[l,f]}return this.dateTabs.timeStr="".concat(s.default.timeFormat(a[0])," ~ ").concat(s.default.timeFormat(a[1])),{dimension:e,start_time:a}}},watch:{query:{deep:!0,handler:function(t){this.getCloudDataDebounce()}}},computed:{}};e.default=d}).call(this,a("a9ff")["default"])},b6ce:function(t,e,a){"use strict";a.r(e);var n=a("f9da"),i=a("2804");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);var s=a("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"51c4a00e",null,!1,n["a"],void 0);e["default"]=u.exports},c6a8:function(t,e,a){"use strict";a.r(e);var n=a("6bbf"),i=a("08a1");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);var s=a("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"58313c0e",null,!1,n["a"],void 0);e["default"]=u.exports},d146:function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 水平间距 */\r\n/* 水平间距 */\r\n/* 行为相关颜色 */\r\n/* 兼容 uni-ui 相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.flex.center[data-v-364289df]{justify-content:center;align-items:center;color:#666}',""]),t.exports=e},ee10:function(t,e,a){"use strict";a.r(e);var n=a("74b1"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},ef49:function(t,e,a){var n=a("d146");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var i=a("4f06").default;i("3e44d096",n,!0,{sourceMap:!1,shadowMode:!1})},f999:function(t,e,a){"use strict";a.r(e);var n=a("47d73"),i=a("ee10");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);a("5be1");var s=a("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"364289df",null,!1,n["a"],void 0);e["default"]=u.exports},f9da:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniStatTabs:a("ec04").default,uniDatetimePicker:a("f096").default,qiunDataCharts:a("47d7").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"uni-stat--x p-m"},[a("v-uni-view",{staticClass:"uni-stat-card-header"},[t._v("趋势图")]),a("v-uni-view",{staticClass:"flex"},[a("uni-stat-tabs",{attrs:{type:"box",current:t.dateTabs.index,tabs:t.dateTabs.list},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.dateTabsChange.apply(void 0,arguments)}}}),a("uni-datetime-picker",{staticClass:"uni-stat-datetime-picker",attrs:{type:"daterange",end:Date.now(),"return-type":"timestamp","clear-icon":!1},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.datePickerChange.apply(void 0,arguments)}},model:{value:t.dateTabs.time,callback:function(e){t.$set(t.dateTabs,"time",e)},expression:"dateTabs.time"}}),t.dateTabs.timeStr?a("v-uni-view",{staticClass:"uni-stat--tips"},[t._v("当前时间范围："+t._s(t.dateTabs.timeStr))]):t._e()],1),a("uni-stat-tabs",{staticClass:"mb-l",attrs:{type:"box",current:t.statTabs.index,tabs:t.statTabs.list},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.statTabsChange.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"uni-charts-box"},[a("qiun-data-charts",{attrs:{type:"area",chartData:t.chartData,opts:t.opts,errorMessage:t.errorMessage}})],1)],1)},r=[]}}]);